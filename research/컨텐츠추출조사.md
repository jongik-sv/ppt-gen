# 콘텐츠 추출 방식 조사

## 1. 기존 문제점 정리

| 접근 방식 | 문제점 |
|----------|--------|
| **OOXML 출력** | 스크립트 방식에서 플레이스홀더 처리가 잘 안됨 |
| **구조 설명** | LLM이 재현할 때 품질이 낮음 |

### 핵심 질문
> 콘텐츠를 추출할 때 **무엇을 저장해야** 나중에 **고품질로 재현**할 수 있을까요?

---

## 2. 후보 방식 비교

### 방식 1: HTML 기반

```
추출: PPT 콘텐츠 → HTML/CSS로 변환하여 저장
생성: 저장된 HTML을 기반으로 데이터만 치환 → PPTX 변환
```

| 장점 | 단점 |
|------|------|
| LLM이 이해하기 쉬움 | OOXML 고유 기능 손실 가능 |
| 유연한 수정 가능 | |

---

### 방식 2: 이미지 + 시맨틱 설명

```
추출: 
  - 렌더링된 이미지 (시각적 참조용)
  - 시맨틱 설명 (슬롯 개수, 배치, 패턴 유형)

생성:
  - LLM이 시맨틱 설명 보고 매칭
  - 이미지 참조하여 HTML 직접 생성
```

| 장점 | 단점 |
|------|------|
| 품질 높음 (시각적 참조) | LLM 의존도 높음 |
| 유연함 | |

#### LLM 의존도가 높을 때의 우려와 실제 영향

| 우려 | 실제 영향 |
|------|----------|
| 일관성 부족 | 평가 루프로 품질 보장 |
| 재현성 낮음 | 세션에 결과 저장 → 재사용 가능 |
| 품질 편차 | 85점 이상 합격 기준으로 필터링 |
| 비용/속도 | Claude Code 환경에서는 허용 가능 |

**결론**: 디자인 평가 루프가 있으므로 LLM 실수는 자동으로 보완됨

---

### 방식 3: 슬롯 기반 템플릿

```
추출:
  - 콘텐츠를 "슬롯" 단위로 분해
  - 각 슬롯: 위치(%), 크기(%), 타입(텍스트/아이콘/이미지)

생성:
  - 슬롯에 데이터 바인딩
  - 고정된 구조 → 높은 재현성
```

| 장점 | 단점 |
|------|------|
| 재현성 높음 | 유연성 낮음 |
| 예측 가능 | |

---

### 방식 4: HTML 템플릿 + 데이터 바인딩 (하이브리드)

```
추출:
  - 콘텐츠를 HTML 템플릿으로 저장
  - 데이터 슬롯을 플레이스홀더로 표시 ({{title}}, {{items}})
  - 썸네일 이미지 (시각적 참조)

생성:
  - 템플릿 로드 → 데이터 바인딩 → HTML 완성 → PPTX 변환
```

| 장점 | 단점 |
|------|------|
| 정확한 레이아웃 재현 (HTML 그대로) | HTML 템플릿 품질에 의존 |
| 유연한 데이터 교체 | |
| LLM은 "어떤 템플릿 쓸지" + "데이터 생성"만 담당 | |

---

## 3. 방식 비교 요약

| 방식 | 재현성 | 유연성 | LLM 의존도 | 구현 복잡도 |
|------|--------|--------|-----------|------------|
| 1. HTML 기반 | 중 | 높음 | 중 | 낮음 |
| 2. 이미지 + 시맨틱 | 높음 | 높음 | 높음 | 중 |
| 3. 슬롯 기반 | 매우 높음 | 낮음 | 낮음 | 중 |
| 4. HTML 템플릿 + 바인딩 | 높음 | 중 | 낮음 | 중 |

---

## 4. 방식 2 상세 연구: 이미지 + 시맨틱 설명

### 4.1 핵심 개념

```
┌─────────────────────────────────────────────────────────────────────┐
│                         콘텐츠 추출                                   │
├─────────────────────────────────────────────────────────────────────┤
│   원본 PPTX 슬라이드                                                 │
│   ┌─────────────────────────────┐                                   │
│   │  🏢 스마트 물류 시스템       │                                   │
│   │  ┌─────┐ ┌─────┐ ┌─────┐   │                                   │
│   │  │ WMS │ │ TMS │ │ OMS │   │                                   │
│   │  └─────┘ └─────┘ └─────┘   │                                   │
│   └─────────────────────────────┘                                   │
│           │                 │                                       │
│           ▼                 ▼                                       │
│   ┌───────────────┐   ┌─────────────────────────────┐              │
│   │ 렌더링 이미지  │   │  시맨틱 설명 (YAML)          │              │
│   │ thumbnail.png │   │  category, pattern, slots   │              │
│   └───────────────┘   └─────────────────────────────┘              │
└─────────────────────────────────────────────────────────────────────┘
```

### 4.2 추출 시 저장하는 것

| 저장 파일 | 내용 | 용도 |
|----------|------|------|
| `thumbnail.png` | 렌더링된 슬라이드 이미지 | LLM 시각적 참조 |
| `semantic.yaml` | 시맨틱 설명 (패턴, 슬롯, 스타일) | 템플릿 매칭/재현 가이드 |

### 4.3 시맨틱 설명 예시

```yaml
id: grid-3col-icon1
category: grid
pattern: "3열 카드 그리드, 각 카드에 아이콘+제목+설명"

layout:
  type: grid
  columns: 3
  gap: 4%

visual_style:
  card_background: surface
  card_radius: 8px
  icon_size: 48px
  icon_color: primary

slots:
  - name: title
    type: text
    position: top-center
    
  - name: items
    type: array
    count: 3
    item_structure:
      - icon (image, 48x48)
      - title (text, bold, 18px)
      - description (text, 14px, 2 lines max)

thumbnail: thumbnails/grid-3col-icon1.png
```

### 4.4 생성 시 흐름

```
1. LLM이 콘텐츠 분석 → "3가지 시스템 소개 필요"

2. 시맨틱 매칭
   - registry에서 category: grid, count: 3 검색
   - 후보 템플릿의 semantic.yaml 비교

3. 이미지 참조 생성
   - LLM이 thumbnail.png 보고 레이아웃 이해
   - semantic.yaml의 visual_style 참조
   - HTML 직접 생성

4. PPTX 변환 → html2pptx
```

### 4.5 방식 2의 특징

**장점:**
- 시각적 참조로 높은 품질 가능
- 새로운 레이아웃도 유연하게 생성
- 추출 과정이 단순 (이미지 + 설명만)

**단점:**
- LLM이 매번 HTML을 새로 생성해야 함
- 동일 입력에도 결과가 다를 수 있음
- Vision API 비용

### 4.6 LLM 의존도 우려와 해결책

| 우려 | 해결책 |
|------|--------|
| 일관성 부족 | 디자인 평가 루프 (85점 이상 합격) |
| 재현성 낮음 | 세션에 생성된 HTML 저장 → 재사용 |
| 품질 편차 | 3회 시도 후 best_of_3 선택 |

---

## 5. 방식 4 상세 연구: HTML 템플릿 + 데이터 바인딩

### 5.1 핵심 개념

```
┌─────────────────────────────────────────────────────────────────────┐
│                         콘텐츠 추출                                   │
├─────────────────────────────────────────────────────────────────────┤
│   원본 PPTX 슬라이드                                                 │
│   ┌─────────────────────────────┐                                   │
│   │  🏢 스마트 물류 시스템       │                                   │
│   │  ┌─────┐ ┌─────┐ ┌─────┐   │                                   │
│   │  │ WMS │ │ TMS │ │ OMS │   │                                   │
│   │  └─────┘ └─────┘ └─────┘   │                                   │
│   └─────────────────────────────┘                                   │
│                    │                                                │
│                    ▼                                                │
│   ┌─────────────────────────────┐   ┌─────────────────────────────┐ │
│   │  HTML 템플릿                │   │  메타데이터 (YAML)           │ │
│   │  {{title}}, {{#each}}      │   │  slots, category 등         │ │
│   └─────────────────────────────┘   └─────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

### 5.2 추출 시 저장하는 것

| 저장 파일 | 내용 | 용도 |
|----------|------|------|
| `template.html` | 플레이스홀더가 포함된 HTML | 레이아웃 재현 |
| `style.css` | 스타일 정의 | 디자인 재현 |
| `metadata.yaml` | 슬롯 정보, 카테고리, 썸네일 | 템플릿 선택/매칭 |
| `thumbnail.png` | 렌더링된 이미지 | 시각적 참조 |

### 5.3 템플릿 예시

**template.html:**
```html
<div class="slide grid-3col">
  <h1 class="title">{{title}}</h1>
  <div class="cards">
    {{#each items}}
    <div class="card">
      <img src="{{this.icon}}" class="icon">
      <h3>{{this.title}}</h3>
      <p>{{this.description}}</p>
    </div>
    {{/each}}
  </div>
</div>
```

**metadata.yaml:**
```yaml
id: grid-3col-icon1
category: grid
element_count: 3

slots:
  - name: title
    type: text
    required: true
    
  - name: items
    type: array
    min: 2
    max: 6
    item_schema:
      - name: icon
        type: image
      - name: title
        type: text
        max_length: 20
      - name: description
        type: text
        max_length: 50
```

### 5.4 생성 시 흐름

```
1. LLM이 콘텐츠 분석 → "3가지 시스템 소개"
2. 템플릿 매칭 → grid-3col-icon1 선택
3. 데이터 바인딩 → slots에 맞는 JSON 생성
4. HTML 렌더링 → template.html + 데이터
5. PPTX 변환 → html2pptx
```

### 5.5 복잡한 케이스: 세로 비교 카드

**원본:**
```
┌─────────────────────────────────────────────────┐
│  [제목1] WMS 시스템                              │
│  [내용1] 창고 입출고 관리                        │
├─────────────────────────────────────────────────┤
│  [제목2] TMS 시스템                              │
│  [내용2] 배송 경로 최적화                        │
└─────────────────────────────────────────────────┘
```

**메타데이터 (중첩 구조):**
```yaml
slots:
  - name: title
    type: text
    
  - name: cards
    type: array
    item_schema:
      - name: title
        type: text
      - name: content
        type: text
```

**데이터 바인딩:**
```json
{
  "title": "비교 분석",
  "cards": [
    { "title": "WMS 시스템", "content": "창고 입출고 관리" },
    { "title": "TMS 시스템", "content": "배송 경로 최적화" }
  ]
}
```

### 5.6 개별 텍스트박스 그룹핑 문제

**문제:** 본문 플레이스홀더가 아닌 개별 텍스트박스로 구성된 경우

**해결책: 하이브리드 탐지**
```
1. 자동 탐지: 위치/스타일 기반으로 그룹 후보 찾기
   - x 좌표가 비슷함 (±5%)
   - y 좌표가 일정 간격
   - 폰트 크기/스타일이 동일

2. LLM 확인: "이 4개가 리스트 맞나요?" 확인

3. 템플릿 생성: 확인된 그룹을 {{#each}} 구조로 변환
```

---

## 6. 방식 2+4 하이브리드 (권장)

### 6.1 핵심 개념

방식 2(이미지 + 시맨틱)와 방식 4(HTML 템플릿 + 바인딩)를 결합하여 **재현성과 유연성** 모두 확보.

### 6.2 저장 구조 (간소화)

```
templates/contents/{category}/{template-id}/
├── template.html      ← HTML + CSS 통합 (Handlebars 플레이스홀더)
├── template.yaml      ← 메타데이터 + 시맨틱 설명 통합
└── thumbnail.png      ← 시각적 참조
```

**template.html 예시 (CSS 포함):**
```html
<!DOCTYPE html>
<html>
<head>
  <style>
    .slide {
      width: 1920px;
      height: 1080px;
      font-family: var(--font-body);
      background: var(--background);
    }
    .grid-3col .cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 4%;
    }
    .card {
      background: var(--surface);
      border-radius: 8px;
      padding: 24px;
    }
    .card h3 {
      color: var(--primary);
    }
  </style>
</head>
<body>
  <div class="slide grid-3col">
    <h1>{{title}}</h1>
    <div class="cards">
      {{#each items}}
      <div class="card">
        <img src="{{this.icon}}" class="icon">
        <h3>{{this.title}}</h3>
        <p>{{this.description}}</p>
      </div>
      {{/each}}
    </div>
  </div>
</body>
</html>
```

**template.yaml 예시 (상세 시맨틱 포함):**
```yaml
# === 기본 정보 ===
id: grid-3col-icon1
category: grid
element_count: 3
description: "3열 아이콘 카드 그리드. 각 카드는 아이콘, 제목, 설명으로 구성"

# === 레이아웃 상세 ===
layout:
  type: grid
  columns: 3
  gap: 4%
  alignment: center
  content_area:
    x: 5%
    y: 20%
    width: 90%
    height: 75%

# === 요소별 상세 스타일 ===
elements:
  slide_title:
    position: { x: 5%, y: 5%, width: 90%, height: 10% }
    font_size: 48px
    font_weight: bold
    text_align: left
    color: dark-text

  cards:
    count: 3
    arrangement: horizontal
    gap: 4%
    card_style:
      background: surface
      border_radius: 16px
      padding: 32px
      shadow: "0 4px 12px rgba(0,0,0,0.1)"
      
    icon:
      position: top-center
      size: 64px
      background: primary
      shape: circle
      color: white
      
    title:
      font_size: 24px
      font_weight: bold
      color: primary
      margin_top: 20px
      text_align: center
      
    description:
      font_size: 16px
      color: dark-text
      line_height: 1.6
      text_align: center
      max_lines: 3

# === 슬롯 정의 (데이터 바인딩) ===
slots:
  - name: title
    type: text
    required: true
    example: "핵심 서비스"
    
  - name: items
    type: array
    min: 2
    max: 6
    item_schema:
      - name: icon
        type: image
        description: "48x48 흰색 아이콘"
      - name: title
        type: text
        max_length: 20
        example: "스마트 물류"
      - name: description
        type: text
        max_length: 80
        example: "AI 기반 창고 관리 및 배송 최적화"

# === 검색/매칭 ===
match_keywords:
  - 그리드
  - 카드
  - 3열
  - 아이콘
  - 서비스 소개

# === 시맨틱 설명 (LLM 재현용) ===
semantic_description: |
  슬라이드 상단에 왼쪽 정렬된 큰 제목(48px, bold)이 있습니다.
  그 아래 3개의 동일한 크기의 카드가 가로로 균등 배치됩니다.
  각 카드는 둥근 모서리(16px)와 그림자가 있는 흰색 배경입니다.
  카드 상단 중앙에 원형 아이콘(primary 색상 배경, 64px)이 있고,
  그 아래에 볼드 제목(24px, primary 색상),
  그 아래에 설명 텍스트(16px, 회색, 최대 3줄)가 중앙 정렬되어 있습니다.
  전체적으로 균등한 간격(4%)으로 배치됩니다.
```

**테마 변수 주입 (생성 시):**
```css
/* 생성 시점에 <head>에 삽입 */
:root {
  --primary: #1E5128;
  --secondary: #4E9F3D;
  --background: #FFFFFF;
  --surface: #F4F6F6;
  --font-heading: "Arial";
  --font-body: "Malgun Gothic";
}
```

### 6.3 생성 시 선택 로직

```
사용자 요청
    │
    ▼
┌─────────────────────────────────────────────────┐
│ 1. 템플릿 매칭 (registry 검색)                   │
└─────────────────────────────────────────────────┘
    │
    ├── 매칭 성공 (기존 템플릿 있음)
    │   │
    │   ▼
    │   ┌─────────────────────────────────────────┐
    │   │ 방식 4: HTML + CSS 템플릿 + 데이터 바인딩 │
    │   │ → 정확한 레이아웃, 일관된 품질            │
    │   └─────────────────────────────────────────┘
    │
    └── 매칭 실패 (새로운 레이아웃 필요)
        │
        ▼
        ┌─────────────────────────────────────────┐
        │ 방식 2: 이미지 + 시맨틱 참조하여 생성     │
        │ → 유사 템플릿 이미지 보고 HTML+CSS 생성   │
        └─────────────────────────────────────────┘
```

### 6.4 장점

| 항목 | 효과 |
|------|------|
| **재현성** | 기존 템플릿 = 100% 동일 (HTML+CSS 그대로) |
| **유연성** | 새 레이아웃도 생성 가능 (이미지 참조) |
| **품질 일관성** | CSS로 스타일 고정 |
| **비용 절감** | 기존 템플릿은 Vision 불필요 |

### 6.5 학습 루프

```
1. 방식 2로 새 HTML+CSS 생성
2. 디자인 평가 통과 (85점+)
3. 생성된 HTML+CSS를 새 템플릿으로 저장
4. 다음에 같은 패턴 → 방식 4로 빠르게 재현
```

### 6.6 시나리오별 동작

| 시나리오 | 사용 방식 | 결과 |
|---------|----------|------|
| "3개 항목 그리드" → 템플릿 존재 | **방식 4** | template.html + style.css + 데이터 |
| "7개 항목 허니콤" → 템플릿 없음 | **방식 2** | 유사 템플릿 참조 + 새 HTML+CSS 생성 |
| 생성 성공 후 | **자동 저장** | 새 템플릿으로 등록 |

---

## 7. 결론

> ✅ **권장 방식: 방식 2+4 하이브리드**
>
> **전략**:
> 1. **메인 (방식 4)**: HTML+CSS 템플릿으로 구조와 레이아웃을 1:1 재현.
> 2. **복잡한 그래픽 (방식 2)**: 6단계 휠 등 복잡한 인포그래픽은 **"이미지"로 저장**하고 텍스트만 오버레이.